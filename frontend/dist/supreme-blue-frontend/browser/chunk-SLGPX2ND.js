import{c as h}from"./chunk-ACY4WVXQ.js";import{a as u}from"./chunk-YCMZOG5D.js";import{Ra as i,X as s,_ as a,da as n,dc as l,yc as c}from"./chunk-6JSNIO2G.js";var S=(()=>{class o{http;router;apiUrl=`${u.apiUrl}/auth`;_user=i(null);_token=i(null);user=this._user.asReadonly();isAuthenticated=l(()=>!!this._token());constructor(t,e){this.http=t,this.router=e,this.loadFromStorage()}loadFromStorage(){let t=localStorage.getItem("accessToken"),e=localStorage.getItem("user");t&&e&&(this._token.set(t),this._user.set(JSON.parse(e)))}login(t,e){return this.http.post(`${this.apiUrl}/login`,{username:t,password:e}).pipe(s(r=>{this._token.set(r.accessToken),this._user.set(r.user),localStorage.setItem("accessToken",r.accessToken),localStorage.setItem("refreshToken",r.refreshToken),localStorage.setItem("user",JSON.stringify(r.user))}))}refreshToken(){let t=localStorage.getItem("refreshToken");if(!t){this.logout();return}return this.http.post(`${this.apiUrl}/refresh`,{refreshToken:t}).pipe(s(e=>{this._token.set(e.accessToken),localStorage.setItem("accessToken",e.accessToken),localStorage.setItem("refreshToken",e.refreshToken)}))}logout(){this._token.set(null),this._user.set(null),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),this.router.navigate(["/login"])}getToken(){return this._token()}hasRole(t){let e=this._user();return e?t.includes(e.role):!1}isAdmin(){return this.hasRole(["ADMIN"])}isManager(){return this.hasRole(["ADMIN","MANAGER"])}static \u0275fac=function(e){return new(e||o)(n(c),n(h))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();export{S as a};
