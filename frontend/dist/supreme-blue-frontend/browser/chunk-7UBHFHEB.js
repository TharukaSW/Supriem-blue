import{a as ye,b as Me,c as xe}from"./chunk-3MKJWEFB.js";import{a as H}from"./chunk-SLGPX2ND.js";import{a as te,b as ne}from"./chunk-3AGII5U5.js";import{a as me,b as ce,c as de,d as se,e as pe,f as ue,g as fe,h as _e,i as Ce,j as he,k as ge}from"./chunk-XYH6MH5Y.js";import{a as ae,b as re}from"./chunk-ZJOCXRYO.js";import{b as X,c as Y,d as ie,e as oe}from"./chunk-K2SJH3O2.js";import{a as j,b as W,c as q,d as K,f as U}from"./chunk-B7D3IYK4.js";import{a as z,g as G,h as J}from"./chunk-MH2VXUWF.js";import{b as N,f as Q,i as F,s as $,u as Z,w as ee}from"./chunk-HNMV2PS5.js";import"./chunk-ACY4WVXQ.js";import{a as le}from"./chunk-INZLI3TU.js";import{Y as L}from"./chunk-RFM3TPKV.js";import"./chunk-YCMZOG5D.js";import{Eb as I,Fb as a,Gb as M,Ha as m,Hb as D,Ia as E,Ib as w,Jb as O,Kb as R,Lb as V,Nb as B,Ra as f,Ya as c,bb as d,gb as T,ha as k,ib as v,jb as b,kb as i,lb as n,mb as S,nb as C,oa as p,ob as h,pa as u,qb as A,tb as g,uc as P,vb as y}from"./chunk-6JSNIO2G.js";var Ee=(t,o)=>o.userId;function Se(t,o){if(t&1&&(i(0,"mat-option",8),a(1),n()),t&2){let e=o.$implicit;d("value",e),m(),w(" ",e.userCode," - ",e.fullName," ")}}function Te(t,o){if(t&1&&(i(0,"div",9)(1,"strong"),a(2),n(),a(3),n()),t&2){let e,r,l=y();m(2),M((e=l.selectedEmployee())==null?null:e.userCode),m(),D(" - ",(r=l.selectedEmployee())==null?null:r.fullName," ")}}function we(t,o){t&1&&(i(0,"div",14),S(1,"mat-spinner",16),n())}function ke(t,o){t&1&&(i(0,"th",25),a(1,"Employee"),n())}function ve(t,o){if(t&1&&(i(0,"td",26),a(1),n()),t&2){let e=o.$implicit;m(),w("",e.user==null?null:e.user.userCode," - ",e.user==null?null:e.user.fullName,"")}}function be(t,o){t&1&&(i(0,"th",25),a(1,"Time In"),n())}function Ae(t,o){if(t&1&&(i(0,"td",26),a(1),n()),t&2){let e=o.$implicit,r=y(2);m(),M(r.formatTime(e.timeIn))}}function Ie(t,o){t&1&&(i(0,"th",25),a(1,"Time Out"),n())}function De(t,o){if(t&1&&(i(0,"td",26),a(1),n()),t&2){let e=o.$implicit,r=y(2);m(),M(r.formatTime(e.timeOut))}}function Oe(t,o){t&1&&(i(0,"th",25),a(1,"Hours"),n())}function Re(t,o){if(t&1&&(i(0,"td",26),a(1),n()),t&2){let e=o.$implicit;m(),M(e.systemHours)}}function Ve(t,o){t&1&&S(0,"tr",27)}function Be(t,o){t&1&&S(0,"tr",28)}function Pe(t,o){if(t&1&&(i(0,"table",15),C(1,17),c(2,ke,2,0,"th",18)(3,ve,2,2,"td",19),h(),C(4,20),c(5,be,2,0,"th",18)(6,Ae,2,1,"td",19),h(),C(7,21),c(8,Ie,2,0,"th",18)(9,De,2,1,"td",19),h(),C(10,22),c(11,Oe,2,0,"th",18)(12,Re,2,1,"td",19),h(),c(13,Ve,1,0,"tr",23)(14,Be,1,0,"tr",24),n()),t&2){let e=y();d("dataSource",e.records()),m(13),d("matHeaderRowDef",e.displayedColumns),m(),d("matRowDefColumns",e.displayedColumns)}}var dt=(()=>{class t{api;authService;snackBar;searchQuery="";employees=f([]);selectedEmployee=f(null);records=f([]);loading=f(!0);processing=f(!1);displayedColumns=["userCode","timeIn","timeOut","hours"];constructor(e,r,l){this.api=e,this.authService=r,this.snackBar=l}ngOnInit(){this.loadTodayRecords()}loadTodayRecords(){let e=new Date().toISOString().split("T")[0];this.api.get("attendance",{fromDate:e,toDate:e,limit:100}).subscribe({next:r=>{this.records.set(r.data||[]),this.loading.set(!1)},error:()=>this.loading.set(!1)})}searchEmployees(){if(this.searchQuery.length<2){this.employees.set([]);return}this.api.get("attendance/search",{q:this.searchQuery}).subscribe({next:e=>this.employees.set(e)})}selectEmployee(e){this.selectedEmployee.set(e),this.searchQuery=`${e.userCode} - ${e.fullName}`}clockIn(){let e=this.selectedEmployee();e&&(this.processing.set(!0),this.api.post("attendance/clock-in",{userIdentifier:e.userCode}).subscribe({next:()=>{this.snackBar.open(`${e.fullName} clocked in successfully`,"Close",{duration:3e3}),this.loadTodayRecords(),this.processing.set(!1),this.selectedEmployee.set(null),this.searchQuery=""},error:r=>{this.snackBar.open(r.error?.message||"Clock in failed","Close",{duration:5e3}),this.processing.set(!1)}}))}clockOut(){let e=this.selectedEmployee();e&&(this.processing.set(!0),this.api.post("attendance/clock-out",{userIdentifier:e.userCode}).subscribe({next:()=>{this.snackBar.open(`${e.fullName} clocked out successfully`,"Close",{duration:3e3}),this.loadTodayRecords(),this.processing.set(!1),this.selectedEmployee.set(null),this.searchQuery=""},error:r=>{this.snackBar.open(r.error?.message||"Clock out failed","Close",{duration:5e3}),this.processing.set(!1)}}))}formatTime(e){return e?new Date(e).toLocaleTimeString("en-LK",{hour:"2-digit",minute:"2-digit"}):"-"}static \u0275fac=function(r){return new(r||t)(E(le),E(H),E(ie))};static \u0275cmp=k({type:t,selectors:[["app-attendance"]],standalone:!0,features:[B],decls:35,vars:6,consts:[["auto","matAutocomplete"],[1,"page-container"],[1,"page-header"],[1,"clock-card"],[1,"clock-form"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Employee code or name",3,"ngModelChange","ngModel","matAutocomplete"],[3,"optionSelected"],[3,"value"],[1,"selected-employee"],[1,"clock-buttons"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-raised-button","","color","accent",3,"click","disabled"],[1,"records-card"],[1,"loading-container"],["mat-table","",1,"full-width",3,"dataSource"],["diameter","40"],["matColumnDef","userCode"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","timeIn"],["matColumnDef","timeOut"],["matColumnDef","hours"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-header-row",""],["mat-row",""]],template:function(r,l){if(r&1){let s=A();i(0,"div",1)(1,"div",2)(2,"h1"),a(3,"Attendance"),n()(),i(4,"mat-card",3)(5,"mat-card-header")(6,"mat-card-title"),a(7,"Clock In / Out"),n()(),i(8,"mat-card-content")(9,"div",4)(10,"mat-form-field",5)(11,"mat-label"),a(12,"Search Employee"),n(),i(13,"input",6),V("ngModelChange",function(_){return p(s),R(l.searchQuery,_)||(l.searchQuery=_),u(_)}),g("ngModelChange",function(){return p(s),u(l.searchEmployees())}),n(),i(14,"mat-autocomplete",7,0),g("optionSelected",function(_){return p(s),u(l.selectEmployee(_.option.value))}),v(16,Se,2,3,"mat-option",8,Ee),n()(),c(18,Te,4,2,"div",9),i(19,"div",10)(20,"button",11),g("click",function(){return p(s),u(l.clockIn())}),i(21,"mat-icon"),a(22,"login"),n(),a(23," Clock IN "),n(),i(24,"button",12),g("click",function(){return p(s),u(l.clockOut())}),i(25,"mat-icon"),a(26,"logout"),n(),a(27," Clock OUT "),n()()()()(),i(28,"mat-card",13)(29,"mat-card-header")(30,"mat-card-title"),a(31,"Today's Records"),n()(),i(32,"mat-card-content"),c(33,we,2,0,"div",14)(34,Pe,15,3,"table",15),n()()()}if(r&2){let s=I(15);m(13),O("ngModel",l.searchQuery),d("matAutocomplete",s),m(3),b(l.employees()),m(2),T(l.selectedEmployee()?18:-1),m(2),d("disabled",!l.selectedEmployee()||l.processing()),m(4),d("disabled",!l.selectedEmployee()||l.processing()),m(9),T(l.loading()?33:34)}},dependencies:[P,$,N,Q,F,U,j,q,K,W,J,G,z,Y,X,ee,Z,re,ae,ne,te,oe,xe,ye,L,Me,ge,me,de,fe,se,ce,_e,pe,ue,Ce,he],styles:[".clock-card[_ngcontent-%COMP%]{margin-bottom:24px}.clock-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;max-width:500px}.search-field[_ngcontent-%COMP%]{width:100%}.selected-employee[_ngcontent-%COMP%]{padding:12px 16px;background:#e3f2fd;border-radius:8px}.clock-buttons[_ngcontent-%COMP%]{display:flex;gap:16px}.clock-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;height:56px}.records-card[_ngcontent-%COMP%]{min-height:300px}"]})}return t})();export{dt as AttendanceComponent};
