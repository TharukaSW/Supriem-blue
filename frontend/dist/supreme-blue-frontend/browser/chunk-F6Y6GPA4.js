import{a as Nt,b as Ft,c as Pt,d as $t,e as At,f as Rt,g as q,h as Ot}from"./chunk-S6CVKGS6.js";import{a as Dt,b as yt,c as kt,d as Lt}from"./chunk-4IKFU3EN.js";import{a as ht,b as gt,c as vt,d as xt,e as Mt,f as St,g as bt,h as Et,i as wt,j as It,k as Tt}from"./chunk-XYH6MH5Y.js";import{a as ft,b as Ct}from"./chunk-ZJOCXRYO.js";import{b as A,c as R,d as V,e as j}from"./chunk-K2SJH3O2.js";import{a as st,c as lt,f as ct}from"./chunk-B7D3IYK4.js";import{a as F,b as dt,d as ut,g as P,h as $}from"./chunk-MH2VXUWF.js";import{b as k,d as L,f as N,g as Q,i as tt,j as et,l as it,o as ot,q as nt,r as at,s as rt,t as mt,u as O,v as pt,w as B}from"./chunk-HNMV2PS5.js";import{c as K}from"./chunk-ACY4WVXQ.js";import{a as _t}from"./chunk-INZLI3TU.js";import"./chunk-RFM3TPKV.js";import"./chunk-YCMZOG5D.js";import{Fb as r,Gb as C,Ha as s,Hb as S,Ia as d,Jb as X,Kb as Y,Lb as Z,Nb as T,Ra as E,Ya as c,_ as W,bb as u,da as J,db as U,gb as w,ha as b,kb as a,lb as o,mb as p,nb as h,oa as x,ob as g,pa as M,qb as I,qc as D,tb as f,uc as y,vb as v}from"./chunk-6JSNIO2G.js";var H=(()=>{class e{api;endpoint="masters/customers";constructor(t){this.api=t}getAll(t){return this.api.get(this.endpoint,t)}getOne(t,n=!1){return this.api.get(`${this.endpoint}/${t}`,{includePrices:n})}create(t){return this.api.post(this.endpoint,t)}update(t,n){return this.api.patch(`${this.endpoint}/${t}`,n)}deactivate(t,n){return this.api.patch(`${this.endpoint}/${t}/deactivate`,{reason:n})}getPrices(t,n){return this.api.get(`${this.endpoint}/${t}/prices`,n)}getActivePrice(t,n,i){return this.api.get(`${this.endpoint}/${t}/prices/active/${n}`,{asOfDate:i})}createPrice(t,n){return this.api.post(`${this.endpoint}/${t}/prices`,n)}updatePrice(t,n,i){return this.api.put(`${this.endpoint}/${t}/prices/${n}`,i)}deactivatePrice(t,n,i){return this.api.put(`${this.endpoint}/${t}/prices/${n}/deactivate`,{endDate:i})}static \u0275fac=function(n){return new(n||e)(J(_t))};static \u0275prov=W({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Ut(e,m){e&1&&(a(0,"mat-error"),r(1," Customer code is required "),o())}function Xt(e,m){e&1&&(a(0,"mat-error"),r(1," Customer name is required "),o())}function Yt(e,m){e&1&&(a(0,"mat-error"),r(1," Invalid email format "),o())}var G=(()=>{class e{fb;customerService;snackBar;dialogRef;data;form;saving=!1;constructor(t,n,i,l,_){this.fb=t,this.customerService=n,this.snackBar=i,this.dialogRef=l,this.data=_}ngOnInit(){this.form=this.fb.group({customerCode:[{value:this.data.customer?.customerCode||"",disabled:this.data.mode==="edit"},[L.required]],customerName:[this.data.customer?.customerName||"",[L.required]],contactName:[this.data.customer?.contactName||""],phone:[this.data.customer?.phone||""],email:[this.data.customer?.email||"",[L.email]],address:[this.data.customer?.address||""]})}onSave(){if(this.form.valid){this.saving=!0;let t=this.form.getRawValue();(this.data.mode==="create"?this.customerService.create(t):this.customerService.update(this.data.customer.customerId,t)).subscribe({next:()=>{this.snackBar.open(`Customer ${this.data.mode==="create"?"created":"updated"} successfully`,"Close",{duration:3e3}),this.dialogRef.close(!0)},error:i=>{this.snackBar.open(i.error?.message||"Error saving customer","Close",{duration:3e3}),this.saving=!1}})}}onCancel(){this.dialogRef.close(!1)}static \u0275fac=function(n){return new(n||e)(d(at),d(H),d(V),d(Nt),d(Ft))};static \u0275cmp=b({type:e,selectors:[["app-customer-form-dialog"]],standalone:!0,features:[T],decls:37,vars:7,consts:[["mat-dialog-title",""],[1,"customer-form",3,"formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","customerCode","placeholder","CUS001","required",""],[4,"ngIf"],["matInput","","formControlName","customerName","placeholder","XYZ Trading Ltd","required",""],["matInput","","formControlName","contactName","placeholder","Jane Doe"],[1,"form-row"],["appearance","outline",1,"half-width"],["matInput","","formControlName","phone","placeholder","+94771234567"],["matInput","","formControlName","email","type","email","placeholder","customer@example.com"],["matInput","","formControlName","address","rows","3","placeholder","456 Business Park, Colombo"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(n,i){if(n&1&&(a(0,"h2",0),r(1),o(),a(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),r(6,"Customer Code"),o(),p(7,"input",3),c(8,Ut,2,0,"mat-error",4),o(),a(9,"mat-form-field",2)(10,"mat-label"),r(11,"Customer Name"),o(),p(12,"input",5),c(13,Xt,2,0,"mat-error",4),o(),a(14,"mat-form-field",2)(15,"mat-label"),r(16,"Contact Name"),o(),p(17,"input",6),o(),a(18,"div",7)(19,"mat-form-field",8)(20,"mat-label"),r(21,"Phone"),o(),p(22,"input",9),o(),a(23,"mat-form-field",8)(24,"mat-label"),r(25,"Email"),o(),p(26,"input",10),c(27,Yt,2,0,"mat-error",4),o()(),a(28,"mat-form-field",2)(29,"mat-label"),r(30,"Address"),o(),p(31,"textarea",11),o()()(),a(32,"mat-dialog-actions",12)(33,"button",13),f("click",function(){return i.onCancel()}),r(34,"Cancel"),o(),a(35,"button",14),f("click",function(){return i.onSave()}),r(36),o()()),n&2){let l,_,z;s(),C(i.data.mode==="create"?"Add New Customer":"Edit Customer"),s(2),u("formGroup",i.form),s(5),u("ngIf",(l=i.form.get("customerCode"))==null?null:l.hasError("required")),s(5),u("ngIf",(_=i.form.get("customerName"))==null?null:_.hasError("required")),s(14),u("ngIf",(z=i.form.get("email"))==null?null:z.hasError("email")),s(8),u("disabled",!i.form.valid||i.saving),s(),S(" ",i.saving?"Saving...":"Save"," ")}},dependencies:[y,D,mt,et,k,N,Q,nt,it,ot,q,$t,Rt,At,B,O,$,P,F,dt,R,A,j],styles:[".customer-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;min-width:500px;padding:20px 0}.full-width[_ngcontent-%COMP%]{width:100%}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px}.half-width[_ngcontent-%COMP%]{flex:1}"]})}return e})();function Zt(e,m){e&1&&(a(0,"th",20),r(1,"Code"),o())}function Kt(e,m){if(e&1&&(a(0,"td",21),r(1),o()),e&2){let t=m.$implicit;s(),C(t.customerCode)}}function Qt(e,m){e&1&&(a(0,"th",20),r(1,"Name"),o())}function te(e,m){if(e&1&&(a(0,"td",21)(1,"div")(2,"strong"),r(3),o(),a(4,"div",22),r(5),o()()()),e&2){let t=m.$implicit;s(3),C(t.customerName),s(2),C(t.contactName||"-")}}function ee(e,m){e&1&&(a(0,"th",20),r(1,"Contact"),o())}function ie(e,m){if(e&1&&(a(0,"td",21)(1,"div")(2,"div"),r(3),o(),a(4,"div",22),r(5),o()()()),e&2){let t=m.$implicit;s(3),C(t.phone||"-"),s(2),C(t.email||"-")}}function oe(e,m){e&1&&(a(0,"th",20),r(1,"Address"),o())}function ne(e,m){if(e&1&&(a(0,"td",21),r(1),o()),e&2){let t=m.$implicit;s(),S(" ",t.address||"-"," ")}}function ae(e,m){e&1&&(a(0,"th",20),r(1,"Status"),o())}function re(e,m){if(e&1&&(a(0,"td",21)(1,"mat-chip"),r(2),o()()),e&2){let t=m.$implicit;s(),U("active",t.isActive)("inactive",!t.isActive),s(),S(" ",t.isActive?"Active":"Inactive"," ")}}function me(e,m){e&1&&(a(0,"th",20),r(1,"Actions"),o())}function se(e,m){if(e&1){let t=I();a(0,"button",26),f("click",function(){x(t);let i=v().$implicit,l=v();return M(l.deactivateCustomer(i))}),a(1,"mat-icon"),r(2,"block"),o()()}}function le(e,m){if(e&1){let t=I();a(0,"td",21)(1,"button",23),f("click",function(){let i=x(t).$implicit,l=v();return M(l.viewCustomer(i))}),a(2,"mat-icon"),r(3,"visibility"),o()(),a(4,"button",24),f("click",function(){let i=x(t).$implicit,l=v();return M(l.editCustomer(i))}),a(5,"mat-icon"),r(6,"edit"),o()(),c(7,se,3,0,"button",25),o()}if(e&2){let t=m.$implicit;s(7),u("ngIf",t.isActive)}}function ce(e,m){e&1&&p(0,"tr",27)}function de(e,m){e&1&&p(0,"tr",28)}function ue(e,m){if(e&1){let t=I();a(0,"button",2),f("click",function(){x(t);let i=v(2);return M(i.addCustomer())}),r(1," Add First Customer "),o()}}function pe(e,m){if(e&1&&(a(0,"div",18)(1,"mat-icon"),r(2,"groups"),o(),a(3,"p"),r(4),o(),c(5,ue,2,0,"button",29),o()),e&2){let t=v();s(4),C(t.searchText?"No customers found":"No customers added yet"),s(),w(t.searchText?-1:5)}}function fe(e,m){e&1&&(a(0,"div",19)(1,"p"),r(2,"Loading customers..."),o()())}var We=(()=>{class e{router;customerService;dialog;snackBar;customers=E([]);filteredCustomers=E([]);loading=E(!1);searchText="";displayedColumns=["code","name","contact","address","status","actions"];constructor(t,n,i,l){this.router=t,this.customerService=n,this.dialog=i,this.snackBar=l}ngOnInit(){this.loadCustomers()}loadCustomers(){this.loading.set(!0),this.customerService.getAll().subscribe({next:t=>{let n=Array.isArray(t)?t:t.data||[];this.customers.set(n),this.filteredCustomers.set(n),this.loading.set(!1)},error:()=>{this.snackBar.open("Error loading customers","Close",{duration:3e3}),this.loading.set(!1)}})}applyFilter(){let t=this.searchText.toLowerCase(),n=this.customers().filter(i=>i.customerCode.toLowerCase().includes(t)||i.customerName.toLowerCase().includes(t)||i.contactName&&i.contactName.toLowerCase().includes(t));this.filteredCustomers.set(n)}addCustomer(){this.dialog.open(G,{width:"600px",data:{mode:"create"}}).afterClosed().subscribe(n=>{n&&this.loadCustomers()})}viewCustomer(t){this.router.navigate(["/customers",t.customerId])}editCustomer(t){this.dialog.open(G,{width:"600px",data:{mode:"edit",customer:t}}).afterClosed().subscribe(i=>{i&&this.loadCustomers()})}deactivateCustomer(t){this.dialog.open(Ot,{data:{title:"Deactivate Customer",message:`Are you sure you want to deactivate ${t.customerName}?`,confirmText:"Deactivate"}}).afterClosed().subscribe(i=>{i&&this.customerService.deactivate(t.customerId).subscribe({next:()=>{this.snackBar.open("Customer deactivated successfully","Close",{duration:3e3}),this.loadCustomers()},error:()=>{this.snackBar.open("Error deactivating customer","Close",{duration:3e3})}})})}static \u0275fac=function(n){return new(n||e)(d(K),d(H),d(Pt),d(V))};static \u0275cmp=b({type:e,selectors:[["app-customers-list"]],standalone:!0,features:[T],decls:40,vars:6,consts:[[1,"page-container"],[1,"page-header"],["mat-raised-button","","color","primary",3,"click"],[1,"filters"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Search by code or name...",3,"ngModelChange","input","ngModel"],["matSuffix",""],["mat-table","",1,"customers-table",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","contact"],["matColumnDef","address"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","clickable-row",4,"matRowDef","matRowDefColumns"],[1,"no-data"],[1,"loading"],["mat-header-cell",""],["mat-cell",""],[1,"text-muted"],["mat-icon-button","","matTooltip","View Details",3,"click"],["mat-icon-button","","matTooltip","Edit",3,"click"],["mat-icon-button","","matTooltip","Deactivate","color","warn",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Deactivate","color","warn",3,"click"],["mat-header-row",""],["mat-row","",1,"clickable-row"],["mat-raised-button","","color","primary"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"div",1)(2,"h1"),r(3,"Customers"),o(),a(4,"button",2),f("click",function(){return i.addCustomer()}),a(5,"mat-icon"),r(6,"add"),o(),r(7," Add Customer "),o()(),a(8,"mat-card")(9,"mat-card-content")(10,"div",3)(11,"mat-form-field",4)(12,"mat-label"),r(13,"Search Customers"),o(),a(14,"input",5),Z("ngModelChange",function(_){return Y(i.searchText,_)||(i.searchText=_),_}),f("input",function(){return i.applyFilter()}),o(),a(15,"mat-icon",6),r(16,"search"),o()()(),a(17,"table",7),h(18,8),c(19,Zt,2,0,"th",9)(20,Kt,2,1,"td",10),g(),h(21,11),c(22,Qt,2,0,"th",9)(23,te,6,2,"td",10),g(),h(24,12),c(25,ee,2,0,"th",9)(26,ie,6,2,"td",10),g(),h(27,13),c(28,oe,2,0,"th",9)(29,ne,2,1,"td",10),g(),h(30,14),c(31,ae,2,0,"th",9)(32,re,3,5,"td",10),g(),h(33,15),c(34,me,2,0,"th",9)(35,le,8,1,"td",10),g(),c(36,ce,1,0,"tr",16)(37,de,1,0,"tr",17),o(),c(38,pe,6,2,"div",18)(39,fe,3,0,"div",19),o()()()),n&2&&(s(14),X("ngModel",i.searchText),s(3),u("dataSource",i.filteredCustomers()),s(19),u("matHeaderRowDef",i.displayedColumns),s(),u("matRowDefColumns",i.displayedColumns),s(),w(i.filteredCustomers().length===0&&!i.loading()?38:-1),s(),w(i.loading()?39:-1))},dependencies:[y,D,rt,k,N,tt,ct,st,lt,Ct,ft,B,O,pt,Tt,ht,vt,bt,xt,gt,Et,Mt,St,wt,It,Lt,kt,yt,Dt,$,P,F,ut,R,A,q,j],styles:[".page-container[_ngcontent-%COMP%]{padding:24px;max-width:1400px;margin:0 auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:28px}.filters[_ngcontent-%COMP%]{margin-bottom:16px}.search-field[_ngcontent-%COMP%]{width:400px}.customers-table[_ngcontent-%COMP%]{width:100%}.text-muted[_ngcontent-%COMP%]{color:#666;font-size:.9em}mat-chip.active[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}mat-chip.inactive[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.clickable-row[_ngcontent-%COMP%]:hover{background-color:#f5f5f5;cursor:pointer}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;color:#999}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:16px}.loading[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}"]})}return e})();export{We as CustomersListComponent};
