import{a as Le}from"./chunk-6DH2R6ZD.js";import{a as pe,b as de,c as he,d as fe}from"./chunk-QHKVOWXU.js";import{a as oe,b as se}from"./chunk-3AGII5U5.js";import{b as Te,c as ye,d as ke}from"./chunk-4IKFU3EN.js";import{a as _e,b as Ce,c as ge,d as xe,e as Pe,f as Me,g as be,h as Se,i as we,j as ve,k as Ee}from"./chunk-XYH6MH5Y.js";import{a as me,b as ue}from"./chunk-ZJOCXRYO.js";import{b as te,c as ie,d as ce,e as le}from"./chunk-K2SJH3O2.js";import{a as J,c as Q,f as U}from"./chunk-B7D3IYK4.js";import{a as X,d as Y,g as Z,h as ee}from"./chunk-MH2VXUWF.js";import{b as W,f as G,i as K,s as q,u as ne,v as re,w as ae}from"./chunk-HNMV2PS5.js";import{c as H,d as j,g as z}from"./chunk-ACY4WVXQ.js";import"./chunk-RFM3TPKV.js";import"./chunk-YCMZOG5D.js";import{Eb as y,Fb as r,Gb as v,Ha as c,Hb as x,Ia as P,Jb as k,Kb as L,Lb as O,Nb as D,Ob as I,Qb as E,Ra as M,Rb as R,Sb as N,Ya as l,bb as p,gb as b,ha as T,kb as i,lb as n,mb as S,nb as d,oa as _,ob as h,oc as V,pa as C,qb as g,qc as B,sc as F,tb as f,tc as $,uc as A,vb as u}from"./chunk-6JSNIO2G.js";var Oe=()=>["DRAFT","CONFIRMED"];function De(t,a){t&1&&(i(0,"div",9),S(1,"mat-spinner",22),n())}function Ie(t,a){t&1&&(i(0,"th",23),r(1,"PO Number"),n())}function Re(t,a){if(t&1&&(i(0,"td",24)(1,"span",25),r(2),n()()),t&2){let e=a.$implicit;c(2),v(e.purchaseNo)}}function Ne(t,a){t&1&&(i(0,"th",23),r(1,"Date"),n())}function Ve(t,a){if(t&1&&(i(0,"td",24),r(1),E(2,"date"),n()),t&2){let e=a.$implicit;c(),x(" ",R(2,1,e.purchaseDate,"mediumDate")," ")}}function Be(t,a){t&1&&(i(0,"th",23),r(1,"Supplier"),n())}function Fe(t,a){if(t&1&&(i(0,"td",24),r(1),n()),t&2){let e=a.$implicit;c(),x(" ",(e.supplier==null?null:e.supplier.supplierName)||"-"," ")}}function $e(t,a){t&1&&(i(0,"th",23),r(1,"Status"),n())}function Ae(t,a){if(t&1&&(i(0,"td",24)(1,"mat-chip",26),r(2),n()()),t&2){let e=a.$implicit;c(),p("ngClass","status-"+e.status.toLowerCase()),c(),x(" ",e.status," ")}}function He(t,a){t&1&&(i(0,"th",23),r(1,"Total"),n())}function je(t,a){if(t&1&&(i(0,"td",24),r(1),E(2,"currency"),n()),t&2){let e=a.$implicit;c(),x(" ",N(2,1,e.total,"LKR ","symbol","1.2-2")," ")}}function ze(t,a){t&1&&(i(0,"th",23),r(1,"Actions"),n())}function We(t,a){if(t&1){let e=g();i(0,"button",28),f("click",function(){_(e);let o=u().$implicit,m=u();return C(m.editPurchase(o))}),i(1,"mat-icon"),r(2,"edit"),n(),i(3,"span"),r(4,"Edit"),n()()}}function Ge(t,a){if(t&1){let e=g();i(0,"button",28),f("click",function(){_(e);let o=u().$implicit,m=u();return C(m.confirmPurchase(o))}),i(1,"mat-icon"),r(2,"check_circle"),n(),i(3,"span"),r(4,"Confirm"),n()()}}function Ke(t,a){if(t&1){let e=g();i(0,"button",28),f("click",function(){_(e);let o=u().$implicit,m=u();return C(m.receivePurchase(o))}),i(1,"mat-icon"),r(2,"inventory"),n(),i(3,"span"),r(4,"Receive Goods"),n()()}}function qe(t,a){if(t&1){let e=g();i(0,"button",31),f("click",function(){_(e);let o=u().$implicit,m=u();return C(m.cancelPurchase(o))}),i(1,"mat-icon",32),r(2,"cancel"),n(),i(3,"span",33),r(4,"Cancel Order"),n()()}}function Je(t,a){if(t&1){let e=g();i(0,"td",24)(1,"button",27)(2,"mat-icon"),r(3,"more_vert"),n()(),i(4,"mat-menu",null,0)(6,"button",28),f("click",function(){let o=_(e).$implicit,m=u();return C(m.viewPurchase(o))}),i(7,"mat-icon"),r(8,"visibility"),n(),i(9,"span"),r(10,"View Details"),n()(),l(11,We,5,0,"button",29)(12,Ge,5,0,"button",29)(13,Ke,5,0,"button",29)(14,qe,5,0,"button",30),n()()}if(t&2){let e=a.$implicit,s=y(5);c(),p("matMenuTriggerFor",s),c(10),p("ngIf",e.status==="DRAFT"),c(),p("ngIf",e.status==="DRAFT"),c(),p("ngIf",e.status==="CONFIRMED"),c(),p("ngIf",I(5,Oe).includes(e.status))}}function Qe(t,a){t&1&&S(0,"tr",34)}function Ue(t,a){t&1&&S(0,"tr",35)}function Xe(t,a){t&1&&(i(0,"button",36),r(1,"Create your first PO"),n())}function Ye(t,a){if(t&1&&(i(0,"div",21)(1,"mat-icon"),r(2,"shopping_cart"),n(),i(3,"p"),r(4),n(),l(5,Xe,2,0,"button",36),n()),t&2){let e=u();c(4),v(e.searchText?"No purchases found matching your search":"No purchase orders yet"),c(),b(e.searchText?-1:5)}}var Lt=(()=>{class t{purchasingService;router;snackBar;purchases=M([]);filteredPurchases=M([]);loading=M(!1);searchText="";displayedColumns=["purchaseNo","date","supplier","status","total","actions"];constructor(e,s,o){this.purchasingService=e,this.router=s,this.snackBar=o}ngOnInit(){this.loadPurchases()}loadPurchases(){this.loading.set(!0),this.purchasingService.getPurchaseOrders().subscribe({next:e=>{let s=Array.isArray(e)?e:e.data||[];this.purchases.set(s),this.filteredPurchases.set(s),this.loading.set(!1)},error:e=>{console.error("Error loading purchases",e),this.snackBar.open("Error loading purchase orders","Close",{duration:3e3}),this.loading.set(!1)}})}applyFilter(){let e=this.searchText.toLowerCase(),s=this.purchases().filter(o=>o.purchaseNo.toLowerCase().includes(e)||o.supplier?.supplierName.toLowerCase().includes(e));this.filteredPurchases.set(s)}viewPurchase(e){console.log("View PO",e)}editPurchase(e){this.router.navigate(["/purchases",e.purchaseId,"edit"])}confirmPurchase(e){confirm(`Are you sure you want to confirm purchase order ${e.purchaseNo}?`)&&(this.loading.set(!0),this.purchasingService.confirmPurchaseOrder(e.purchaseId).subscribe({next:()=>{this.snackBar.open("Purchase order confirmed","Close",{duration:3e3}),this.loadPurchases()},error:s=>{this.snackBar.open("Error confirming purchase order","Close",{duration:3e3}),this.loading.set(!1)}}))}receivePurchase(e){confirm(`Are you sure you want to mark purchase order ${e.purchaseNo} as received? This will update stock.`)&&(this.loading.set(!0),this.purchasingService.receivePurchaseOrder(e.purchaseId).subscribe({next:()=>{this.snackBar.open("Goods received successfully","Close",{duration:3e3}),this.loadPurchases()},error:s=>{this.snackBar.open("Error receiving goods","Close",{duration:3e3}),this.loading.set(!1)}}))}cancelPurchase(e){let s=prompt("Please enter a cancellation reason:");s!==null&&(this.loading.set(!0),this.purchasingService.cancelPurchaseOrder(e.purchaseId,s).subscribe({next:()=>{this.snackBar.open("Purchase order cancelled","Close",{duration:3e3}),this.loadPurchases()},error:o=>{this.snackBar.open("Error cancelling purchase order","Close",{duration:3e3}),this.loading.set(!1)}}))}static \u0275fac=function(s){return new(s||t)(P(Le),P(H),P(ce))};static \u0275cmp=T({type:t,selectors:[["app-purchases-list"]],standalone:!0,features:[D],decls:41,vars:6,consts:[["menu","matMenu"],[1,"page-container"],[1,"page-header"],["mat-raised-button","","color","primary","routerLink","/purchases/new"],[1,"filters"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Search by PO number or supplier...",3,"ngModelChange","input","ngModel"],["matSuffix",""],[1,"table-container"],[1,"loading-shade"],["mat-table","",1,"purchases-table",3,"dataSource"],["matColumnDef","purchaseNo"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","date"],["matColumnDef","supplier"],["matColumnDef","status"],["matColumnDef","total"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","clickable-row",4,"matRowDef","matRowDefColumns"],[1,"no-data"],["diameter","40"],["mat-header-cell",""],["mat-cell",""],[1,"po-number"],[3,"ngClass"],["mat-icon-button","","aria-label","Actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","","class","text-warn",3,"click",4,"ngIf"],["mat-menu-item","",1,"text-warn",3,"click"],["color","warn"],[1,"text-warn"],["mat-header-row",""],["mat-row","",1,"clickable-row"],["mat-button","","color","primary","routerLink","/purchases/new"]],template:function(s,o){s&1&&(i(0,"div",1)(1,"div",2)(2,"h1"),r(3,"Purchase Orders"),n(),i(4,"button",3)(5,"mat-icon"),r(6,"add"),n(),r(7," New Purchase Order "),n()(),i(8,"mat-card")(9,"mat-card-content")(10,"div",4)(11,"mat-form-field",5)(12,"mat-label"),r(13,"Search Purchases"),n(),i(14,"input",6),O("ngModelChange",function(w){return L(o.searchText,w)||(o.searchText=w),w}),f("input",function(){return o.applyFilter()}),n(),i(15,"mat-icon",7),r(16,"search"),n()()(),i(17,"div",8),l(18,De,2,0,"div",9),i(19,"table",10),d(20,11),l(21,Ie,2,0,"th",12)(22,Re,3,1,"td",13),h(),d(23,14),l(24,Ne,2,0,"th",12)(25,Ve,3,4,"td",13),h(),d(26,15),l(27,Be,2,0,"th",12)(28,Fe,2,1,"td",13),h(),d(29,16),l(30,$e,2,0,"th",12)(31,Ae,3,2,"td",13),h(),d(32,17),l(33,He,2,0,"th",12)(34,je,3,6,"td",13),h(),d(35,18),l(36,ze,2,0,"th",12)(37,Je,15,6,"td",13),h(),l(38,Qe,1,0,"tr",19)(39,Ue,1,0,"tr",20),n(),l(40,Ye,6,2,"div",21),n()()()()),s&2&&(c(14),k("ngModel",o.searchText),c(4),b(o.loading()?18:-1),c(),p("dataSource",o.filteredPurchases()),c(19),p("matHeaderRowDef",o.displayedColumns),c(),p("matRowDefColumns",o.displayedColumns),c(),b(o.filteredPurchases().length===0&&!o.loading()?40:-1))},dependencies:[A,V,B,$,F,z,j,q,W,G,K,U,J,Q,ue,me,ae,ne,re,Ee,_e,ge,be,xe,Ce,Se,Pe,Me,we,ve,ke,ye,Te,ee,Z,X,Y,ie,te,fe,de,pe,he,se,oe,le],styles:[".page-container[_ngcontent-%COMP%]{padding:24px;max-width:1400px;margin:0 auto}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:28px}.filters[_ngcontent-%COMP%]{margin-bottom:16px}.search-field[_ngcontent-%COMP%]{width:400px}.table-container[_ngcontent-%COMP%]{position:relative;min-height:200px}.loading-shade[_ngcontent-%COMP%]{position:absolute;inset:0;background:#ffffffb3;z-index:1;display:flex;align-items:center;justify-content:center}.purchases-table[_ngcontent-%COMP%]{width:100%}.po-number[_ngcontent-%COMP%]{font-weight:500;color:#3f51b5}.status-draft[_ngcontent-%COMP%]{background-color:#e0e0e0;color:#616161}.status-confirmed[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1976d2}.status-received[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#388e3c}.status-cancelled[_ngcontent-%COMP%]{background-color:#ffebee;color:#d32f2f}.clickable-row[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;color:#999}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:16px;color:#ccc}.text-warn[_ngcontent-%COMP%]{color:#f44336}"]})}return t})();export{Lt as PurchasesListComponent};
